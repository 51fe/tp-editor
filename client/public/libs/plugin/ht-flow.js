!function(n){"use strict";var B=n.ht,T=B.Default,v=T.getInternal(),t=v.ui(),w=null,E="__segmentLengths",S="__lineTotalLength",A="__linePoints",Y="__distance0",J="flow.count",P="flow.step",x="flow.element.max",I="flow.element.count",N="flow.element.min",Z="flow.element.space",O="flow.element.autorotate",j="flow.element.background",s="flow.element.shadow.max",L="flow.element.shadow.min",a="flow.element.shadow.begincolor",d="flow.element.shadow.endcolor",q="flow.element.shadow.visible",c="flow.element.image",U="flow",$=B.Math.Vector2,C=new $;new $,new $,B.List;var f=B.Default._edgeProtectMethod,b=f.getStraightLinePoints,o=function(l,W){for(var e=[],U=l.length,X=0;U>X;X++){var j=l[X];j._as&&(j=j._as);for(var D=j[0],s=1;s<j.length;s++)e.push([D,j[s]]),D=j[s]}for(var c=[],X=0;X<e.length;X++){var b=z(e[X][0],e[X][1],W);c.push(b)}return{distance:c,segments:e}},H=function(p,d,k){if(p){for(var $,g=o(p,d),S=g.distance,h=g.segments,v=1/0,G=null,V=0,N=S.length;N>V;V++){var q=S[V];q.z<v&&($=V,v=q.z,G=q)}if(null==k&&(k=.1),G.z<k){for(var I=0,w=0;$>=w;w++)I+=T.getDistance(h[w][0],$>w?h[w][1]:G);return I}}},z=function(C,g,F){var A=C.x,U=C.y,t=g.x,$=g.y,P=F.x,j=F.y,B=t-A,X=$-U,m=Math.sqrt(B*B+X*X),D=B/m,l=X/m,N=(-A+P)*D+(-U+j)*l,p={x:A+N*D,y:U+N*l};return p.x>=Math.min(C.x,g.x)&&p.x<=Math.max(C.x,g.x)&&p.y>=Math.min(C.y,g.y)&&p.y<=Math.max(C.y,g.y)||(p.x=Math.abs(p.x-C.x)<Math.abs(p.x-g.x)?C.x:g.x,p.y=Math.abs(p.y-C.y)<Math.abs(p.y-g.y)?C.y:g.y),B=P-p.x,X=j-p.y,p.z=Math.sqrt(B*B+X*X),p},_=function(R,Y){if(R){var $=o(R,Y).distance,G=1/0,M=null;return $.forEach(function(a){a.z<G&&(G=a.z,M=a)}),M}},G=f.calculateLineLength,l=f.calcSegmentIndexByDistance,h=f.calculatePointAlongLine,u=function($,X,f){if(!$)return f;if(0===X){var D=$[0][0],b=$[0][1];return f+Math.atan2(b.y-D.y,b.x-D.x)}if(100===X){$=$[$.length-1];var D=$[$.length-2],b=$[$.length-1];return f+Math.atan2(b.y-D.y,b.x-D.x)}for(var k=0,Y=[],F=$.length,M=0;F>M;M++){var u=$[M],W=G(u);k+=W,Y.push(W)}for(var o=k*X/100,y=l(o,Y),C=0,v=0;y>v;v++)C+=Y[v];o-=C;for(var e=h($[y],o),B=$[y],x=0,H=0,g=0;g<B.length-1;g++){var E=B[g],P=B[g+1],I=P.x-E.x,L=P.y-E.y,i=Math.sqrt(I*I+L*L);if(x+=i,x>o){H=g;break}}var S=B[H];return f+Math.atan2(e.y-S.y,e.x-S.x)},i=function(j){var I=0;if(j)if(Array.isArray(j[0]))for(var p=j.length,s=0;p>s;s++){var a=j[s],l=G(a);I+=l}else I=G(j);return I},K=function(s,M,t,R){return C.set(M,t).rotateAround(null,R),s?{x:s.x+C.x,y:s.y+C.y}:{x:C.x,y:C.y}},V=function(C){var X=C._data,Q=b(C);if(Q){X.s("flow.reverse")&&(Q.reverse(),Q.forEach(function(t){t.reverse()}));for(var L=0,u=[],s=Q.length,i=0;s>i;i++){var J=Q[i],P=G(J);L+=P,u.push(P)}if(X[E]=u,X[S]=L,X[A]=Q,X instanceof B.Edge){var O=T.unionPoint(Q),D=O.x+O.width/2,U=O.y+O.height/2;X.$10e={x:D,y:U}}F(C,!0)}},R=f.getPercentPosition,F=function(s,C){var G=s._data,t=G[S],d=G.s(J),O=G.s(P),X=0,H=G[E],M=G.s(x),b=G.s(N),r=G.s(I),q=(M-b)/(r-1),$=[];if(H){if(1===r)$.push(M);else if(2===r)$.push(M),$.push(b);else{if(!(r>2))return;$.push(M);for(var T=r-2;T>0;T--)$.push(b+q*T);$.push(b)}var K=0,v=0;$.forEach(function(H){r-1>K&&(v+=G.getFlowElementSpace(H)),K++}),v+=(M+b)/2,X=(t-d*v+v)/d;var u=s[Y];for(null==u&&(u=0),C||(u+=O);u>t+v;){var y=s._overCount;y?y++:y=1,y>=d&&(y=null),s._overCount=y,G.s("flow.autoreverse")?y?u-=X+v:(u=0,G.s("flow.reverse",!G.s("flow.reverse"))):u-=X+v}s[Y]=u}},m="prototype",M=B.graph.GraphView[m],X=B.Data[m],k=t.DataUI[m],g=t.ShapeUI[m],y=t.EdgeUI[m],r=B.DataModel[m],p=B.Style;p[x]==w&&(p[x]=7),p[N]==w&&(p[N]=0),p[J]==w&&(p[J]=1),p[P]==w&&(p[P]=3),p[I]==w&&(p[I]=10),p[Z]==w&&(p[Z]=3.5),p[O]==w&&(p[O]=!1),p[j]==w&&(p[j]="rgba(255, 255, 114, 0.4)"),p[a]==w&&(p[a]="rgba(255, 255, 0, 0.3)"),p[d]==w&&(p[d]="rgba(255, 255, 0, 0)"),p[q]==w&&(p[q]=1),p[s]==w&&(p[s]=22),p[L]==w&&(p[L]=4),M.calculatePointLength=function(l,a,t){var u=this.getDataUI(l),G=b(u);return H(G,a,t)},T.calculatePointLength=function(F,V,g,r){var c=b(w,F,V);return H(c,g,r)},T.calculateClosestPointOnLine=z,M.calculateClosestPoint=function(P,Z){var G=this.getDataUI(P),E=b(G);return _(E,Z)},T.calculateClosestPoint=function(F,X,e){var D=b(w,F,X);return _(D,e)},M.getPercentAngle=function(q,C){var l=this.getDataUI(q),g=b(l);return q.getRotation?q.getRotation():0,u(g,C,q.getRotation?q.getRotation():0)},T.getPercentAngle=function(B,V,q){var L=b(w,B,V);return u(L,q,0)},M.calculateLength=function(l){var o=this.getDataUI(l),L=b(o);return i(L)},T.calculateLength=function(M,F){var k=b(w,M,F);return i(k)},M.getPercentPosition=function(w,H){var X=this.getDataUI(w),Z=b(X);return R(Z,H)},T.getPercentPositionOnPoints=function(D,Q,J){var Y=b(w,D,Q);return R(Y,J)};var D=function(z){var u=z.data,T=this.dm();if(u&&"add"===z.kind){var w=T.$3e;w&&u.s(U)&&w.indexOf(u)<0&&w.push(u)}"clear"===z.kind&&(T.$3e=[])},e=function(x){var n=x.property,t=x.data,G=x.newValue,J=this.dm().$3e;if(J&&"s:flow"===n)if(G)J.indexOf(t)<0&&J.push(t);else for(var p=J.length,s=0;p>s;s++)if(J[s]===t){J.splice(s,1);break}},Q=M.setDataModel;M.setDataModel=function(r){var o=this,I=o._dataModel;if(I!==r){I&&(I.umm(D,o),I.umd(e,o),I.$3e=[]),r.mm(D,o),r.md(e,o);var q=r.$3e=[];r.each(function(S){S.s(U)&&q.indexOf(S)<0&&q.push(S)}),Q.call(o,r)}},X.getFlowElementSpace=function(){return this.s(Z)};var W=function(r){var t=this,n=t._data,v=n[S],f=n[E],a=n[A],T=n.s(J),e=0,$=t[Y],z=n.s(x),u=n.s(N),Z=n.s(I),R=n.s(L),o=n.s(s),_=n.s(O),G=(o-R)/(Z-1),P=(z-u)/(Z-1),q=n.getRotation?n.getRotation():0,W=n.getPosition?n.p():n.$10e,U=[],k=[];if($!=w){if(1===Z)U.push(z);else if(2===Z)U.push(z),U.push(u);else{if(!(Z>2))return;U.push(z);for(var y=Z-2;y>0;y--)U.push(u+P*y);U.push(u)}if(1===Z)k.push(o);else if(2===Z)k.push(o),k.push(R);else{if(!(Z>2))return;k.push(o);for(var y=Z-2;y>0;y--)k.push(R+G*y);k.push(R)}var X=0,F=0;U.forEach(function(T){Z-1>X&&(F+=n.getFlowElementSpace(T)),X++}),F+=(z+u)/2,e=(v-T*F+F)/T,r.save();for(var y=0;T>y;y++){var g=$,M=0,d=t._overCount,p=0;n.s("flow.autoreverse")&&d&&d>T-(y+1)||(g-=y*(e+F),X=0,U.forEach(function(s){var I=g-M;if(I>=0&&v>I){var G=!0,F=l(I,f);p=0;for(var Z=0;F>Z;Z++)p+=f[Z];if(I-=p,G){var d=h(a[F],I),b=q;if(_){for(var J=a[F],e=0,o=0,L=0;L<J.length-1;L++){var H=J[L],S=J[L+1],j=S.x-H.x,O=S.y-H.y,P=Math.sqrt(j*j+O*O);if(e+=P,e>I){o=L;break}}var Q=J[o];b+=Math.atan2(d.y-Q.y,d.x-Q.x)}q&&(d=K(W,d.x-W.x,d.y-W.y,q)),t.$5e(r,d,s,k[X],b)}}M+=n.getFlowElementSpace(U[X]),X++}))}r.restore()}},wj=y._80o;y._80o=function(u){wj.call(this,u);var T=this,E=T._data,n=T.gv;E.s(U)&&n.$7e!=w&&W.call(T,u)};var We=g._80o;g._80o=function(m){We.call(this,m);var p=this,C=p._data,n=p.gv;C.s(U)&&n.$7e!=w&&W.call(p,m)};var oj=y._79o,tl=g._79o,Xn=function(){var _=this,X=_._data,Q=X.s(x),z=!1,f=w;if(_._6I||(z=!0),f=X instanceof B.Edge?oj.call(_):tl.call(_),X.s(U)&&z){var g=X.s(s),v=X.s(q);v&&g>Q&&(Q=g),Q>0&&T.grow(f,Math.ceil(Q/2)),V(_)}return!X.s(U)&&z&&(X[E]=X[S]=X[A]=_[Y]=w),f};g._79o=Xn,y._79o=Xn,k.$5e=function(O,M,D,y,B){var Y=this,h=Y._data,F=Y.gv,g=h.s(j),U=h.s(a),_=h.s(d),o=h.s(q),G=F.$8e,P=h.s(c);if(G==w&&(G=F.$8e={}),O.beginPath(),P!=w){var A=T.getImage(P),t=D/2;O.translate(M.x,M.y),O.rotate(B),O.translate(-M.x,-M.y),T.drawImage(O,A,M.x-t,M.y-t,D,D,h),O.translate(M.x,M.y),O.rotate(-B),O.translate(-M.x,-M.y)}else if(F.__flowBatch){var J=F.__flowBatchGroup;J||(J=F.__flowBatchGroup={});var R=[M.x,M.y,D/2];J[g]?J[g].push(R):J[g]=[R]}else O.fillStyle=g,O.arc(M.x,M.y,D/2,0,2*Math.PI,!0),O.fill();if(o){var W=22,x=W+"_"+U+"_"+_,k=G[x];if(k==w){var i=document.createElement("canvas");v.setCanvas(i,W,W);var K=i.getContext("2d"),Z=W/2,m=Z,N=Z;v.translateAndScale(K,0,0,1),K.beginPath();var X=K.createRadialGradient(m,N,0,m,m,Z);X.addColorStop(0,U),X.addColorStop(1,_),K.fillStyle=X,K.arc(m,N,Z,0,2*Math.PI,!0),K.fill(),k=G[x]=i}var t=y/2;T.drawImage(O,k,M.x-t,M.y-t,y,y,h)}},M.$9e=function(){var w=this,F=w.dm().$3e;w._24I,F.forEach(function(M){w._24I[M._id]=M}),w.iv()};var Op=r.prepareRemove;r.prepareRemove=function(f){Op.call(this,f);var Y=f._dataModel,V=Y.$3e;if(V)for(var R=V.length,r=0;R>r;r++)if(V[r]===f){V.splice(r,1);break}},M.setFlowInterval=function(L){var T=this,X=T.$11e;T.$11e=L,T.fp("flowInterval",X,L),T.$7e!=w&&(clearInterval(T.$7e),delete T.$7e,T.enableFlow(L))},M.getFlowInterval=function(){return this.$11e},M.enableFlow=function(X){var d=this,l=d.dm(),L=l.$3e;d.$7e==w&&(L.forEach(function(O){var W=d.getDataUI(O);V(W)}),d.$7e=setInterval(function(){l.$3e.forEach(function(l){F(d.getDataUI(l))}),d.$9e()},X||d.$11e||50))},M.disableFlow=function(){var t=this;clearInterval(t.$7e),delete t.$7e;var Q=t.dm().$3e;Q&&t.$9e()};var mn=function(){this.__flowBatchGroup={}},Qg=function(h){var T=this.__flowBatchGroup;if(T){h.save();for(var B in T){h.fillStyle=B,h.beginPath();var A=T[B];A.forEach(function(T){h.moveTo(T[0],T[1]),h.arc(T[0],T[1],T[2],0,2*Math.PI,!0)}),h.fill()}h.restore()}};M.setFlowBatch=function(A){var v=this;!!v.__flowBatch!=!!A&&(v.__flowBatch=A,A?(v.addBottomPainter(mn),v.addTopPainter(Qg)):(v.removeBottomPainter(mn),v.removeTopPainter(Qg)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);